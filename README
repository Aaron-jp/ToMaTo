route add -net 10.1.1.0/24 gw 10.0.0.254
route add -net default gw 10.0.0.254

vzctl create 124 --ostemplate debian
vzctl set 124 --applyconfig virconel.basic --save
vzctl set 124 --hostname myhost1 --save
vzctl set 124 --ipadd 10.1.1.4 --save
vzctl set 124 --devices c:10:200:rw --save
vzctl set 124 --capability net_admin:on --save

vzctl start 124
sleep 5
vzctl exec 124 route del -net default dev venet0
vzctl exec 124 route add -host myhost0 dev venet0
vzctl exec 124 "echo '1' >/proc/sys/net/ipv4/ip_forward"
vzctl exec 124 mkdir -p /dev/net
vzctl exec 124 mknod /dev/net/tun c 10 200
vzctl exec 124 chmod 600 /dev/net/tun

vzctl set 124 --ipdel all --save
vzctl stop 124

vzctl set 124 --netif_add eth4 --save
vzctl exec 124 ifconfig eth4 10.1.1.3 netmask 255.255.255.0 up
brctl addif br0 veth124.4

vzctl exec 124 iptables -t mangle -A PREROUTING -m recent --set
vzctl exec 124 iptables -t mangle -A FORWARD -m recent --remove --rttl -j TTL --ttl-dec 1

modprobe 8021q
vconfig add eth0 999
ifconfig eth0.0 up

vconfig add eth0 4
ifconfig eth0.4 up
brctl addif br0 eth0.4

ifconfig eth0.4 down
vconfig rem eth0.4

tinc-vpn.org
http://www.faqs.org/docs/Linux-HOWTO/BRIDGE-STP-HOWTO.html
