{% extends "top/base.html" %}

{% block content %}
<h1>Detail view of topology "{{top.name}}" [{{top.id}}] </h1>

Owner: {{top.owner}}<br/>
Created: {{top.date_created}}, modified: {{top.date_modified}}<br/>
Devices: {{top.device_count}}<br/>
Connectors: {{top.connector_count}}<br/>
<br/>

<ul class="topology_analysis">
{% for p in top.analysis.problems %}
<li class="problem">Problem: {{p}}</li>
{% endfor %}

{% for w in top.analysis.warnings %}
<li class="warning">Warning: {{w}}</li>
{% endfor %}

{% for w in top.analysis.hints %}
<li class="hint">Hint: {{h}}</li>
{% endfor %}
</ul>

<script language="javascript"><!--
function console (url) {
    var nw = window.open(url, '_blank', "innerWidth=745,innerheight=400");
    nw.focus();
}
--></script>

<table>
	<tr>
		<th>Device ID</th>
		<th>Type</th>
		<th>Host</th>
		<th>State</th>
		<th>Actions</th>
	</tr>
{% for name, dev in top.devices %}
	<tr>
		<td>{{dev.id}}</td>
		<td>{{dev.type}}</td>
		<td>{{dev.host}}</td>
		<td>{{dev.state}}</td>
		<td>
{% if dev.is_created %}
		<a href="{%url top.dev_prepare top_id=top_id device_id=dev.id%}">prepare</a>
{% endif %}		
{% if dev.is_prepared %}
		<a href="{%url top.dev_start top_id=top_id device_id=dev.id%}">start</a>
{% endif %}
{% if dev.is_prepared or dev.is_started %}
		<a href="{%url top.dev_stop top_id=top_id device_id=dev.id%}">stop</a>
{% endif %}
{% if dev.is_prepared or dev.is_created %}
		<a href="{%url top.dev_destroy top_id=top_id device_id=dev.id%}">destroy</a>
{% endif %}
{% if dev.is_started %}
		<a href="javascript:console('{%url top.vncview top_id=top.id device_id=dev.id%}');">console</a>
{% endif %}
{% if dev.is_prepared %}
		<a href="{%url top.upload_image top_id=top_id device_id=dev.id%}">upload image</a>
		<a href="{%url top.download_image top_id=top_id device_id=dev.id%}">download image</a>
{% endif %}
		</td>		
	</tr>
{% endfor %}
</table>

<br/><br/>

<table>
	<tr>
		<th>Connector ID</th>
		<th>Type</th>
		<th>State</th>
		<th>Actions</th>
	</tr>
{% for name, con in top.connectors %}
	<tr>
		<td>{{con.id}}</td>
		<td>{{con.type}}</td>
		<td>{{con.state}}</td>
		<td>
{% if con.is_created %}
		<a href="{%url top.con_prepare top_id=top_id connector_id=con.id%}">prepare</a>
{% endif %}		
{% if con.is_prepared %}
		<a href="{%url top.con_start top_id=top_id connector_id=con.id%}">start</a>
{% endif %}
{% if con.is_prepared or con.is_started %}
		<a href="{%url top.con_stop top_id=top_id connector_id=con.id%}">stop</a>
{% endif %}
{% if con.is_prepared or con.is_created %}
		<a href="{%url top.con_destroy top_id=top_id connector_id=con.id%}">destroy</a>
{% endif %}
		</td>		
	</tr>
{% endfor %}
</table>

{% if action %}
<h2>Executing {{action}} ...</h2>
<iframe width="80%" height="60%" frameborder="0" src="{%url main.task_status task_id%}"></iframe>
{% endif %}

{% endblock %}

{% block left %}
<div id="sidemenu">
	<h2>Topology {{top_id}}</h2>
	<ul>
		<li><a href="{%url top.details top_id%}">details</a></li>
		<li><a href="{%url top.showxml top_id%}">show</a></li>
		<li><a href="{%url top.showxml top_id%}?plain">download</a></li>
		<li><a href="{%url top.edit top_id%}">edit</a></li>
		<li><a href="{%url top.remove top_id%}" onclick="javascript:return confirm('Are you sure? The topology definition will be deleted!')">remove</a></li>
	</ul>
</div>

<div id="sidemenu">
	<h2>Deployment</h2>
	<ul>
		<li><a href="{%url top.start top_id%}">start</a></li>
		<li><a href="{%url top.stop top_id%}">stop</a></li>
		<li><a href="{%url top.prepare top_id%}">prepare</a></li>
		<li><a href="{%url top.destroy top_id%}" onclick="javascript:return confirm('Are you sure? All device data will be lost!')">destroy</a></li>
	</ul>
</div>
{% endblock %}