{% extends "top/base.html" %}

{% block content %}
<h1>Detail view of topology "{{top.name}}" [{{top.id}}] </h1>
<!-- %%%GLABNETMAN%%%TOPOLOGY%%%{{top.id}}%%%{{task_id}}%%% -->
<script src="/static/enhancetable.js"></script>

Owner: {{top.attrs.owner}} <a href="{%url top.permission_list top_id=top_id%}"><img src="/static/icons/permissions.png" alt="permissions" title="permissions"/></a>
<br/>
Created: {{top.attrs.date_created}}, modified: {{top.attrs.date_modified}}<br/>
Last usage: {{top.attrs.date_usage}} <a href="{%url top.renew top_id=top_id %}"><img src="/static/icons/refresh.png" alt="renew" title="renew"/></a> <a href="{%url main.help page="TopologyTimeout" %}" target="_help"><img src="/static/icons/help.png" alt="info" title="info"/></a><br/>
Devices: {{top.attrs.device_count}}<br/>
Connectors: {{top.attrs.connector_count}}<br/>
{% if top.attrs.finished_task %}
<a href="{%url main.task_status top.finished_task%}" target="_blank">last task</a><br>
{% endif %}
<br/>

<script language="javascript"><!--
function console (url) {
	var console = window.open(url, '_blank', "innerWidth=745,innerheight=400,status=no,toolbar=no,menubar=no,location=no,hotkeys=no,scrollbars=no");
    console.focus();
}
--></script>

<table class="sortable,filterable">
	<tr>
		<th>Device name</th>
		<th>Type</th>
		<th>Host</th>
		<th>State</th>
		<th>Actions</th>
	</tr>
{% for name, dev in top.devices.items %}
	<tr>
		<td>{{dev.attrs.name}}</td>
		<td>{{dev.attrs.type}}</td>
		<td>{% if dev.attrs.host %}<a href="{% url host.detail hostname=dev.attrs.host %}">{{dev.attrs.host}}</a>{% else %}-{% endif %}</td>
		<td>{{dev.attrs.state}}</td>
		<td>
{% if dev.attrs.state == "prepared" %}
		<a href="{%url top.dev_start top_id=top_id device_id=dev.attrs.name%}"><img src="/static/icons/start.png" alt="start" title="start"/></a>
{% endif %}
{% if dev.attrs.state == "prepared" or dev.attrs.state = "started" %}
		<a href="{%url top.dev_stop top_id=top_id device_id=dev.attrs.name%}"><img src="/static/icons/stop.png" alt="stop" title="stop"/></a>
{% endif %}
{% if dev.attrs.state == "created" %}
		<a href="{%url top.dev_prepare top_id=top_id device_id=dev.attrs.name%}"><img src="/static/icons/prepare.png" alt="prepare" title="prepare"/></a>
{% endif %}		
{% if dev.attrs.state == "prepared" or dev.attrs.state == "created" %}
		<a href="{%url top.dev_destroy top_id=top_id device_id=dev.attrs.name%}"><img src="/static/icons/destroy.png" alt="destroy" title="destroy"/></a>
{% endif %}
{% if dev.attrs.state == "started" and dev.attrs.vnc_port %}
		<a href="javascript:console('{%url top.console%}?host={{dev.attrs.host}}&port={{dev.attrs.vnc_port}}&password={{dev.attrs.vnc_password}}&topology={{top.attrs.name}}&device={{dev.attrs.name}}');"><img src="/static/icons/console.png" alt="console" title="console"/></a>
{% endif %}
		</td>		
	</tr>
{% endfor %}
</table>

<br/><br/>

<table class="sortable,filterable">
	<tr>
		<th>Connector name</th>
		<th>Type</th>
		<th>State</th>
		<th>Actions</th>
	</tr>
{% for name, con in top.connectors.items %}
	<tr>
		<td>{{con.attrs.name}}</td>
		<td>{{con.attrs.type}}</td>
		<td>{{con.attrs.state}}</td>
		<td>
{% if con.attrs.state == "prepared" %}
		<a href="{%url top.con_start top_id=top_id connector_id=con.attrs.name%}"><img src="/static/icons/start.png" alt="start" title="start"/></a>
{% endif %}
{% if con.attrs.state == "prepared" or con.attrs.state == "started" %}
		<a href="{%url top.con_stop top_id=top_id connector_id=con.attrs.name%}"><img src="/static/icons/stop.png" alt="stop" title="stop"/></a>
{% endif %}
{% if con.attrs.state == "created" %}
		<a href="{%url top.con_prepare top_id=top_id connector_id=con.attrs.name%}"><img src="/static/icons/prepare.png" alt="prepare" title="prepare"/></a>
{% endif %}		
{% if con.attrs.state == "prepared" or con.attrs.state == "created" %}
		<a href="{%url top.con_destroy top_id=top_id connector_id=con.attrs.name%}"><img src="/static/icons/destroy.png" alt="destroy" title="destroy"/></a>
{% endif %}
		</td>		
	</tr>
{% endfor %}
</table>

<br/>

<h2>Resource usage <a href="#" onclick="javascript:var el = document.getElementById('resource_usage');el.style.display = (el.style.display != 'none' ? 'none' : '' );">[show/hide]</a></h2>
<table id="resource_usage" class="sortable,filterable" style="display:none">
	<tr>
		<th>ID</th>
		<th>Disk space</th>
		<th>Memory</th>
		<th>Traffic</th>
		<th>Ports</th>
		<th>Special</th>
	</tr>
{% for name, dev in top.devices.items %}
{% if dev.resources %}
	<tr>
		<td>{{dev.attrs.name}}</td>
		<td enhancetable_customkey="{{dev.resources.disk}}">{{dev.resources.disk|filesizeformat}}</td>
		<td enhancetable_customkey="{{dev.resources.memory}}">{{dev.resources.memory|filesizeformat}}</td>
		<td enhancetable_customkey="{{dev.resources.traffic}}">{{dev.resources.traffic|filesizeformat}}</td>
		<td>{{dev.resources.ports}}</td>
		<td>{{dev.resources.special}}</td>
	</tr>
{% endif %}
{% endfor %}
{% for name, con in top.connectors.items %}
{% if con.resources %}
	<tr>
		<td>{{con.attrs.name}}</td>
		<td enhancetable_customkey="{{con.resources.disk}}">{{con.resources.disk|filesizeformat}}</td>
		<td enhancetable_customkey="{{con.resources.memory}}">{{con.resources.memory|filesizeformat}}</td>
		<td enhancetable_customkey="{{con.resources.traffic}}">{{con.resources.traffic|filesizeformat}}</td>
		<td>{{con.resources.ports}}</td>
		<td>{{con.resources.special}}</td>
	</tr>
{% endif %}
{% endfor %}
{% if top.resources %}
	<tr>
		<td><b>Total</b></td>
		<td enhancetable_customkey="{{top.resources.disk}}"><b>{{top.resources.disk|filesizeformat}}</b></td>
		<td enhancetable_customkey="{{top.resources.disk}}"><b>{{top.resources.memory|filesizeformat}}</b></td>
		<td enhancetable_customkey="{{top.resources.traffic}}">{{top.resources.traffic|filesizeformat}}</td>
		<td><b>{{top.resources.ports}}</b></td>
		<td><b>{{top.resources.special}}</b></td>
	</tr>
{% endif %}
</table>

{% if action %}
<h2>Executing {{action}} ...</h2>
<iframe width="80%" height="60%" frameborder="0" src="{%url main.task_status task_id%}?backurl={%url top.details top_id%}"></iframe>
{% else %}

{% if top.running_task %}
<h2>Running task ...</h2>
<iframe width="80%" height="60%" frameborder="0" src="{%url main.task_status top.running_task%}?backurl={%url top.details top_id%}"></iframe>
{% endif %}

{% endif %}

{% endblock %}
