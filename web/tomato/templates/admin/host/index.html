{% extends "admin/base.html" %}

{% load tomato %}

{% block content %}
<h1>List of hosts</h1>

{% if host_list %}
<script src="/js/enhancetable.js"></script>

{% if hostManager %}
<p><input type="button" onClick="window.location='/host/add'" value="Add host" /></p>
{% endif %}

<table class="sortable,filterable">
  <tr>
    <th>Address</th>
    <th>Site</th>
    <th>Info age</th>
    <th>Uptime</th>
    <th>Time diff</th>
    <th>Query time</th>
    <th>CPUs</th>
    <th>Bogomips</th>
    <th>Load</th>
    <th>Disk</th>
    <th>Usage root</th>
    <th>Usage data</th>
    <th>RAM</th>
    <th>Usage</th>
    {% if hostManager %}
    <th />
    {% endif %}
  </tr>
{% for host in host_list %}
  <tr>
    <td>{{host.address}}</td>
    <td>{{host.site}}</td>
    <td enhancetable_customkey="{{host.host_info_timestamp}}">{{host.host_info_timestamp|age|toduration}}</td>
    <td enhancetable_customkey="{{host.host_info.uptime}}">{{host.host_info.uptime|toduration}}</td>
    <td enhancetable_customkey="{{host.host_info.time_diff}}">{{host.host_info.time_diff|floatformat:2}} s</td>
    <td enhancetable_customkey="{{host.host_info.query_time}}">{{host.host_info.query_time|mult:1000|floatformat:0}} ms</td>
    <td>{{host.host_info.resources.cpus_present.count}}</td>
    <td>{{host.host_info.resources.cpus_present.bogomips_avg|floatformat}}</td>
    <td>{{host.host_info.resources.loadavg|slice:"1:2"|first}}</td>
    <td enhancetable_customkey="{{host.host_info.resources.diskspace.root.total|add:host.host_info.resources.diskspace.data.total}}">{{host.host_info.resources.diskspace.root.total|add:host.host_info.resources.diskspace.data.total|mult:1024|filesizeformat}}</td>
    <td>{{host.host_info.resources.diskspace.root.used|percentage:host.host_info.resources.diskspace.root.total}}</td>
    <td>{{host.host_info.resources.diskspace.data.used|percentage:host.host_info.resources.diskspace.data.total}}</td>
    <td enhancetable_customkey="{{host.host_info.resources.memory.total}}">{{host.host_info.resources.memory.total|mult:1024|filesizeformat}}</td>
    <td>{{host.host_info.resources.memory.used|percentage:host.host_info.resources.memory.total}}</td>
    {% if hostManager %}
    <td><small><a href="/host/edit?address={{host.address}}"><img src="/img/server_edit.png" title="edit" /></a> &nbsp; <a href="/host/remove?address={{host.address}}" ><img src="/img/server_delete.png" title="remove" /></a></small></td>
    {% endif %}
  </tr>
{% endfor %}
</table>
{% else %}
No hosts
{% endif %}

{% if hostManager %}
<p><input type="button" onClick="window.location='/host/add'" value="Add host" /></p>
{% endif %}

{% endblock %}
