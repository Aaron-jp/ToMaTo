
#include <layer5/dhcp_server.repy>
#include <layer3/icmp_node.repy>
#include <util/parse_args.repy>
#include <util/run_forever.repy>
#include <util/ip_util.repy>
#include <util/mac_util.repy>

class Server(DHCPServer,ICMPNode):
    def __init__(self, **kwargs):
        DHCPServer.__init__(self, **kwargs)
        ICMPNode.__init__(self, **kwargs)

if callfunc == 'initialize':
    defaults = {"ip":"10.0.0.1", "mac":random_mac(), "gateway":"10.0.0.254", "pool":"10.0.0.3-250", "netmask":"255.255.255.0", "domain":"example.com", "nameserver":"10.0.0.254"}
    options = parse_args(defaults)
    echo("Options: %s" % options)
    options["ip"] = str_to_ip(options["ip"])
    options["gateway"] = str_to_ip(options["gateway"])
    options["nameserver"] = str_to_ip(options["nameserver"])
    options["netmask"] = str_to_ip(options["netmask"])
    options["pool"] = range_to_ips(options["pool"])
    node = Server(**options)
    run_forever(node.handle)